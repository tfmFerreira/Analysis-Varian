clear all%expno = [20 25 31:44];%expno = 1;basl=[0.01 .1 .65 .75 .9 .99];phc0 = -158; phc1 = -430;ppmcalibval = 13.9;lb = 10;ppmcalib = 0.385132;pivot=0.45;%si = 100*1024;%autophase = 1;export = 1;Treal=[];Tset=[];power=[40754 43000 43916 44101 44131 44500 46775 50297];figure(2), clffigure(4), clffor nexp = 1:length(power)    eval(['cd 20251031_13C_rinept_37C_DECpwr' num2str(power(nexp)) '.fid'])    load output.txtload Bf1.txtA=output;bf1=Bf1;     dw= A(2,1)-A(1,1);    swh=1/(dw);    t = A(:,1);    td=length(t);    if exist('si') == 0,             powers=1:20;            powers=2.^powers;            sipos=find(powers>length(t));            si=powers(sipos(4));    end    nu = swh*linspace(0, 1, si)'; nu = nu - nu(si/2+1);    ppm = nu/bf1;    S = A(:,2) + i*A(:,3);    %figure(1), clf, plot(real(S)), return            %real part    Stemp = S(:,1);    %figure(1), clf, plot(real(Stemp)), return        %line broadening    lbfun = exp(-lb*pi*t);    %lbfun = exp(-abs(lb*pi*(t-t(round(grpdly)))));    Stemp = lbfun.*Stemp;    %figure(1), clf, plot(t,real(Stemp),t,lbfun*max(real(Stemp))), return          %if si>(td/2), Stemp = [Stemp; zeros(si-td/2,1)]; end    if si>(td/2), Stemp = [Stemp(1:(td)); zeros(si-td,1)]; end %Stemp((td/2-round(grpdly)+1):(td/2))]; end    %figure(1), clf, plot(real(Stemp)), cd .., return    Stemp(1) = 0.5*Stemp(1);    %Itemp = fftshift(fft(Stemp,si));    Itemp = flipud(fftshift(fft(Stemp,si)));    %figure(1), clf, plot([1:si]/si,real(Itemp)), return        baslpoints = [];    for nbasl = 1:2:length(basl)-1        baslpoints = [baslpoints round(basl(nbasl)*si):round(basl(nbasl+1)*si)];    end    baslpoints = baslpoints';        if exist('pivot')==1    else    pivot = max(find(abs(Itemp) == max(abs(Itemp))))/si;    end    pivotpoint = round(pivot*si);    Itemp0 = Itemp;        if exist('autophase') == 1        Pout = fminsearch('entropy_fun2',[20 -50],[],Itemp0,baslpoints,pivotpoint);        phc0=Pout(1);        phc1=Pout(2);    end             Itemp = fPhCorr(Itemp0.',phc0,phc1,pivotpoint); Itemp = Itemp.';    Itemp = Itemp - mean(Itemp(baslpoints));            if exist('ppmcalibval') == 0        figure(1), clf        subplot(2,1,1)        plot((1:si)/si,real(Itemp),pivotpoint/si,0,'ro')        set(gca,'XDir','reverse')        subplot(2,1,2)        plot((1:si)/si,real(Itemp),pivotpoint/si,0,'ro',baslpoints/si,zeros(size(baslpoints)),'r.')        axis([0 1 min(real(Itemp)) max(real(Itemp))*.05])        set(gca,'XDir','reverse')        %save phcDat phc0 phc1 pivot        cd .., return    end    PolyCoeff = polyfit(baslpoints,Itemp(baslpoints),3);    Itemp = Itemp - polyval(PolyCoeff,(1:si)');    %figure(1), clf, plot(1:si,real(Itemp),baslpoints,zeros(size(baslpoints)),'r.'), cd .., return    ppmcalibpoint = round(ppmcalib*si);    ppm = ppm - ppm(ppmcalibpoint) + ppmcalibval;        nu=ppm*bf1;    if exist('export') == 0        figure(1), clf        plot(ppm,real(Itemp),ppm(ppmcalibpoint),real(Itemp(ppmcalibpoint)),'ro',ppm(round(pivot*si)),real(Itemp(round(pivot*si))),'go')        set(gca,'XDir','reverse')        cd ../.., return    end        I = real(Itemp);    fontsize = 16;    linewidth = 1;        figure(2),        figure(4),    set(gcf, 'Renderer', 'Painters');    plot(ppm,I/max(I)+nexp-1,'k-','LineWidth',linewidth), hold on    set(gca,'YTick',[],'LineWidth',1.5*linewidth,'Box','off','TickDir','out','Ycolor',[1 1 1],'FontSize',fontsize*.8)    xlim([10 40])    ylim([-.2 length(power)+.1])    text(40,nexp-.5,[num2str(power(nexp))])    %title(['dec power =' num2str(power(nexp))] , 'FontSize',10)    set(gca,'XDir','reverse')        save SpecDat ppm I    cd ..endprint -depsc INEPT.eps